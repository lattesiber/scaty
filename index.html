<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scaty</title>
  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc);
      background-size: 400% 400%;
      animation: gradientBG 12s ease infinite;
      color: white;
    }
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .container { padding: 20px; }
    .project-card {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .project-card:hover { background: rgba(0,0,0,0.7); }
    /* Modal */
    #modal {
      display:none;
      position:fixed;
      top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.7);
      justify-content:center;
      align-items:center;
    }
    #modalContent {
      background:white;
      color:black;
      border-radius:12px;
      padding:20px;
      max-width:600px;
      width:90%;
      max-height:90%;
      overflow-y:auto;
      position:relative;
    }
    #closeModal {
      position:absolute;top:10px;right:10px;
      background:red;color:white;border:none;
      padding:6px 12px;border-radius:8px;
      cursor:pointer;
    }
    #likeButton {
      background:#ff4081;
      color:white;
      border:none;
      padding:8px 14px;
      cursor:pointer;
      border-radius:8px;
      margin-top:10px;
      font-weight:bold;
    }
    .messages {
      margin-top:15px;
      background:#f1f1f1;
      padding:10px;
      border-radius:8px;
      max-height:200px;
      overflow-y:auto;
    }
    .message-input {
      display:flex;
      gap:5px;
      margin-top:8px;
    }
    .message-input input {
      flex:1;padding:6px;
    }
    .message-input button {
      padding:6px 12px;
      border:none;
      background:#2575fc;
      color:white;
      border-radius:6px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Scaty Projeleri</h2>
    <div id="projects"></div>
  </div>

  <!-- Modal -->
  <div id="modal">
    <div id="modalContent">
      <button id="closeModal" onclick="closeModal()">Kapat</button>
      <h2 id="modalTitle"></h2>
      <p><strong>Kullanıcı:</strong> <span id="modalUser"></span></p>
      <div id="modalEmbed"></div>
      <button id="likeButton">Beğen</button> <span id="likeCount">0</span> beğeni
      <h3>Mesajlar</h3>
      <div class="messages" id="messagesBox"></div>
      <div class="message-input">
        <input type="text" id="messageInput" placeholder="Mesaj yaz...">
        <button onclick="sendMessage()">Gönder</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Firebase config seninkiyle aynı olmalı
    const firebaseConfig = {
      apiKey: "AIzaSyBeIlybkEY-iOMjiR2-Y7hjLXDqn3umZ9k",
      authDomain: "scaty-9bd07.firebaseapp.com",
      databaseURL: "https://scaty-9bd07-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "scaty-9bd07",
      storageBucket: "scaty-9bd07.firebasestorage.app",
      messagingSenderId: "649442785955",
      appId: "1:649442785955:web:cb7405c5c0bd88907e9d16",
      measurementId: "G-LLYXBZZX0X"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const projectsDiv = document.getElementById("projects");
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalUser = document.getElementById("modalUser");
    const modalEmbed = document.getElementById("modalEmbed");
    const likeButton = document.getElementById("likeButton");
    const likeCount = document.getElementById("likeCount");
    const messagesBox = document.getElementById("messagesBox");
    const messageInput = document.getElementById("messageInput");

    let currentProjectKey = null;

    // Projeleri listele
    db.ref("projects").on("value", snapshot=>{
      projectsDiv.innerHTML="";
      const data = snapshot.val();
      if(data){
        Object.keys(data).forEach(key=>{
          const p = data[key];
          let div=document.createElement("div");
          div.className="project-card";
          div.innerHTML=`<h3>${p.title}</h3><p>@${p.username}</p>`;
          div.onclick=()=>openModal(p,key);
          projectsDiv.appendChild(div);
        });
      }
    });

    // Modal aç
    function openModal(project,key){
      currentProjectKey = key;
      modalTitle.innerText=project.title;
      modalUser.innerText=project.username;
      modalEmbed.innerHTML=project.yerleştirme;
      modal.style.display="flex";

      // beğeni canlı
      db.ref("projects/"+key+"/likes").on("value", snap=>{
        likeCount.innerText = snap.val() || 0;
      });

      // mesajları canlı çek
      db.ref("messages/"+key).on("value", snap=>{
        messagesBox.innerHTML="";
        const msgs=snap.val();
        if(msgs){
          Object.values(msgs).forEach(m=>{
            let p=document.createElement("p");
            p.innerText=m.user+": "+m.text;
            messagesBox.appendChild(p);
          });
        }
      });

      likeButton.onclick=()=>{
        db.ref("projects/"+key+"/likes").transaction(likes=>{
          return (likes||0)+1;
        });
      };
    }

    function closeModal(){
      modal.style.display="none";
      modalEmbed.innerHTML="";
      messagesBox.innerHTML="";
      currentProjectKey=null;
    }

    function sendMessage(){
      if(!currentProjectKey) return;
      let text=messageInput.value.trim();
      if(text==="") return;
      let user=prompt("Scratch kullanıcı adın:");
      if(!user) return;
      db.ref("messages/"+currentProjectKey).push({
        user,text
      });
      messageInput.value="";
    }
  </script>
</body>
</html>
